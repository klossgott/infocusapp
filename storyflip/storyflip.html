<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Story Flip</title>
    <!-- Include Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Cormorant+Garamond:wght@400;600&display=swap">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
        }
        #widget-container {
            position: relative;
            width: 320px;
            height: 480px;
            background: transparent;
            overflow: hidden;
            perspective: 1000px;
        }
        #widget-card {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background-color: #B0E0E6;
            border-radius: 15px;
            padding: 30px; /* Increased padding for better margin */
            box-sizing: border-box;
            transform: translate(-50%, -50%);
            transform-origin: center center;
            cursor: pointer;
            transition: transform 0.5s ease, background-color 0.3s ease;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation-duration: 0.6s; /* Animation duration */
        }
        #widget-card.resting {
            transform: translate(-50%, -50%) scale(0.7);
        }
        #widget-card.active {
            transform: translate(-50%, -50%) scale(1);
        }
        #card-text {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.5em;
            color: #333;
            line-height: 1.5;
            font-weight: normal;
            letter-spacing: 0.05em;
            margin: 0;
        }
        .typing-animation {
            display: inline-block;
            overflow: hidden;
            white-space: nowrap;
            animation: typing 2s steps(30, end), blink 0.5s step-end infinite alternate;
        }
        #timer {
            position: absolute;
            bottom: 10px;
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1em;
            color: #333;
        }
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        @keyframes blink {
            from, to { border-right-color: transparent; }
            50% { border-right-color: black; }
        }
        @keyframes flipIn {
            from {
                transform: rotateY(90deg);
                opacity: 0;
            }
            to {
                transform: rotateY(0deg);
                opacity: 1;
            }
        }
        @keyframes flipOut {
            from {
                transform: rotateY(0deg);
                opacity: 1;
            }
            to {
                transform: rotateY(-90deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>

<div id="widget-container">
    <div id="widget-card" class="resting">
        <div id="card-text"></div>
        <div id="timer"></div> <!-- Timer element -->
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const prompts = {
            "gameMaster": [
                "<b>A new character enters the story.</b>",
                "<i>Suddenly...</i>",
                "The <b>[place]</b> was ... [describe].",
                "Describe the weather in this scene.",
                "<b>Add a dramatic moment!</b>"
            ],
            "numberCard": [
                "Add [x] word describing what happens next.", // Singular form for '1 word'
                "Add [x] words explaining how [Character] reacts.",
                "Add [x] words to set up a new challenge.",
                "Add [x] words describing the setting.",
                "Add [x] words to build tension."
            ],
            "stuck": [
                "<i>Then, something unexpected happened...</i>",
                "At this moment, [Character] felt <b>[emotion]</b>...",
                "<i>Suddenly, [...] joined the scene.</i>",
                "What happens if something goes wrong?",
                "Describe a noise they heard nearby."
            ],
            "instructions": [
                "Welcome to <b>Story Flip</b>!<br><br>Click the card to start. Each turn, flip the card to receive story instructions. Work together to create a fantastic story!",
                "When you're stuck, press <b>'S'</b> to get a helpful prompt.<br>Click outside the card to end the game."
            ]
        };

        const cardElement = document.getElementById('widget-card');
        const cardTextElement = document.getElementById('card-text');
        const timerElement = document.getElementById('timer');

        let isExpanded = false;
        let cardState = 'resting'; // resting, active, instructions
        let timerInterval;

        // Initial Instructions
        showInstructions();

        // Handle card clicks
        cardElement.addEventListener('click', () => {
            if (cardState === 'resting') {
                expandCard();
            } else if (cardState === 'active') {
                flipCard();
            } else if (cardState === 'instructions') {
                startGame();
            }
        });

        // Close game when clicking outside card
        document.addEventListener('click', (e) => {
            if (!cardElement.contains(e.target)) {
                endGame();
            }
        });

        // Function to show initial instructions
        function showInstructions() {
            const instructionText = prompts.instructions.join("<br><br>");
            cardTextElement.innerHTML = instructionText;
            setCardColor('#FFD700'); // Golden color for instructions
            cardState = 'instructions';
        }

        // Function to expand the card
        function expandCard() {
            cardElement.classList.remove('resting');
            cardElement.classList.add('active');
            cardElement.style.animationName = 'flipIn'; // Flip-in animation
            cardState = 'active';
        }

        // Function to start the game after instructions
        function startGame() {
            cardState = 'resting';
            expandCard();
        }

        // Function to flip the card and show a prompt
        function flipCard() {
            const cardType = getRandomCardType();
            cardElement.style.animationName = 'flipOut'; // Flip-out animation for current prompt
            cardElement.addEventListener('animationend', () => {
                if (cardType === 'gameMaster') {
                    showGameMasterPrompt();
                } else if (cardType === 'numberCard') {
                    showNumberCardPrompt();
                } else if (cardType === 'stuck') {
                    showStuckPrompt();
                }
                cardElement.style.animationName = 'flipIn'; // Flip-in for new prompt
            }, { once: true });
            startTimer(); // Start the timer when a card is flipped
        }

        // Randomly get a card type
        function getRandomCardType() {
            const types = ['gameMaster', 'numberCard', 'stuck'];
            return types[Math.floor(Math.random() * types.length)];
        }

        // Show Game Master prompt
        function showGameMasterPrompt() {
            const prompt = getRandomPrompt('gameMaster');
            setCardColor('#FFA500'); // Warm yellow-orange color
            showTypingAnimation(prompt);
        }

        // Show Number Card prompt
        function showNumberCardPrompt() {
            let prompt = getRandomPrompt('numberCard');
            const num = getRandomNumber(1, 6);
            prompt = num === 1 ? prompt.replace('[x] words', '1 word') : prompt.replace('[x]', num); // Handle singular form
            setCardColor('#ADD8E6'); // Light blue color for number cards
            cardTextElement.innerHTML = prompt;
        }

        // Show Stuck Card prompt
        function showStuckPrompt() {
            const prompt = getRandomPrompt('stuck');
            setCardColor('#A0B0C0'); // Desaturated blue-green
            showTypingAnimation(prompt);
        }

        // Helper to get a random prompt from a specific category
        function getRandomPrompt(category) {
            return prompts[category][Math.floor(Math.random() * prompts[category].length)];
        }

        // Set the card color
        function setCardColor(color) {
            cardElement.style.backgroundColor = color;
        }

        // Show typing animation for game master or stuck cards
        function showTypingAnimation(text) {
            cardTextElement.innerHTML = `<span class="typing-animation">${text}</span>`;
        }

        // Get random number between min and max
        function getRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Start the timer when a card is flipped
        function startTimer() {
            let timeLeft = 30; // 30-second timer
            timerElement.textContent = `Time left: ${timeLeft}s`;
            clearInterval(timerInterval); // Clear any previous timer interval

            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `Time left: ${timeLeft}s`;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerElement.textContent = ''; // Clear timer text when finished
                }
            }, 1000);
        }

        // End game function when clicking outside the card
        function endGame() {
            cardState = 'resting';
            cardElement.classList.remove('active');
            cardElement.classList.add('resting');
            cardTextElement.innerHTML = "The game has ended. Refresh to start a new story.";
            setCardColor('#f5f5f5'); // Neutral color for the end
            timerElement.textContent = ''; // Clear timer
        }
    });
</script>

</body>
</html>
