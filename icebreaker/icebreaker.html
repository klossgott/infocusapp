<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Icebreaker Widget</title>
    <!-- Include Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400&display=swap">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
        }
        #widget-container {
            position: relative;
            width: 320px; /* Fixed width for 16:9 aspect ratio */
            height: 180px; /* Fixed height for 16:9 aspect ratio */
            background: transparent;
        }
        #widget-image {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: filter 0.3s;
            transform-origin: center center; /* Ensure scaling happens from the center */
        }
        /* Mouseover effect */
        #widget-image:hover {
            filter: brightness(1.2);
        }
        /* Exploding animation */
        .explode {
            animation: explodeAndFade 0.5s forwards;
        }
        @keyframes explodeAndFade {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.5);
            }
        }
        #icebreaker-card {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px; /* Same as container width */
            height: 180px; /* Same as container height */
            background-color: #F8F0E3; /* Updated off-white background */
            border-radius: 15px;
            padding: 30px; /* Increased padding for more white space */
            box-sizing: border-box;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation-duration: 0.5s;
            animation-fill-mode: forwards;
            overflow: hidden;
            transform: translate(-50%, -50%); /* Center the card */
        }
        #icebreaker-text {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1em;
            color: #333;
            line-height: 1.5;
            font-weight: bold;
            letter-spacing: 0.05em; /* Increase kerning by 5% */
            margin: 0;
            background: transparent;
        }
        /* Animations for card */
        @keyframes fadeInFlip {
            0% {
                opacity: 0;
                transform: rotateY(90deg) translate(-50%, -50%);
            }
            100% {
                opacity: 1;
                transform: rotateY(0deg) translate(-50%, -50%);
            }
        }
        @keyframes fadeOutFlip {
            0% {
                opacity: 1;
                transform: rotateY(0deg) translate(-50%, -50%);
            }
            100% {
                opacity: 0;
                transform: rotateY(90deg) translate(-50%, -50%);
            }
        }
    </style>
</head>
<body>

<div id="widget-container">
    <img id="widget-image" src="ice-cubes.png" alt="Ice Cubes">
    <div id="icebreaker-card">
        <div id="icebreaker-text"></div>
    </div>
</div>

<!-- Audio element for the ice breaking sound -->
<audio id="ice-sound" src="ice-10-104149.mp3" preload="auto"></audio>

<script>
    const prompts = [
        "What’s the weirdest movie you’ve ever seen?",
        "What’s a pizza topping that most people hate but you secretly love?",
        // ... [Include all your questions here]
        "If you could have an animal as a sidekick, which would you choose?"
    ];

    // Image source
    const initialImageSrc = "ice-cubes.png";
    const clickImageSrc = "broken-ice.png";

    const widgetImage = document.getElementById('widget-image');
    const icebreakerCard = document.getElementById('icebreaker-card');
    const icebreakerText = document.getElementById('icebreaker-text');
    const iceSound = document.getElementById('ice-sound');

    // Set initial image source
    widgetImage.src = initialImageSrc;

    function getRandomPrompt() {
        const randomIndex = Math.floor(Math.random() * prompts.length);
        return prompts[randomIndex];
    }

    widgetImage.addEventListener('click', () => {
        // Play random portion of the ice sound
        playRandomIceSound();

        // Change to broken ice image
        widgetImage.src = clickImageSrc;

        // Add class to trigger exploding animation
        widgetImage.classList.add('explode');

        // Listen for animation end
        widgetImage.addEventListener('animationend', onExplodeAnimationEnd, { once: true });
    });

    function onExplodeAnimationEnd() {
        // Hide the image
        widgetImage.style.display = 'none';
        // Remove the explode class
        widgetImage.classList.remove('explode');
        // Reset the transform
        widgetImage.style.transform = 'translate(-50%, -50%) scale(1)';
        // Show the icebreaker card
        showIcebreaker();
    }

    function showIcebreaker() {
        icebreakerText.textContent = getRandomPrompt();

        // Adjust background color randomly within ±10% lightness
        const baseColor = '#F8F0E3'; // Updated off-white color
        const hsl = hexToHsl(baseColor);
        // Adjust lightness by ±10%
        const lightnessAdjustment = (Math.random() * 20) - 10; // Random between -10 and +10
        const newL = Math.min(100, Math.max(0, hsl.l + lightnessAdjustment));
        const newColor = hslToHex(hsl.h, hsl.s, newL);

        icebreakerCard.style.backgroundColor = newColor;

        icebreakerCard.style.display = 'flex';
        icebreakerCard.style.animationName = 'fadeInFlip';
    }

    icebreakerCard.addEventListener('click', () => {
        icebreakerCard.style.animationName = 'fadeOutFlip';
        icebreakerCard.addEventListener('animationend', () => {
            icebreakerCard.style.display = 'none';
            widgetImage.src = initialImageSrc;
            widgetImage.style.display = 'block';
        }, { once: true });
    });

    function playRandomIceSound() {
        const duration = 1.5; // Play 1.5 seconds

        if (iceSound.readyState >= 2) { // HAVE_CURRENT_DATA
            const totalDuration = iceSound.duration;
            const maxStartTime = Math.max(0, totalDuration - duration);
            const randomStartTime = Math.random() * maxStartTime;
            iceSound.currentTime = randomStartTime;
            iceSound.play();

            setTimeout(() => {
                iceSound.pause();
                iceSound.currentTime = 0;
            }, duration * 1000);
        } else {
            iceSound.addEventListener('loadedmetadata', () => {
                playRandomIceSound();
            }, { once: true });
        }
    }

    // Helper functions to convert between Hex and HSL
    function hexToHsl(hex) {
        // Convert hex to RGB first
        let r = 0, g = 0, b = 0;
        if (hex.length == 4) {
            r = "0x" + hex[1] + hex[1];
            g = "0x" + hex[2] + hex[2];
            b = "0x" + hex[3] + hex[3];
        } else if (hex.length == 7) {
            r = "0x" + hex[1] + hex[2];
            g = "0x" + hex[3] + hex[4];
            b = "0x" + hex[5] + hex[6];
        }
        r /= 255;
        g /= 255;
        b /= 255;
        const cmin = Math.min(r,g,b);
        const cmax = Math.max(r,g,b);
        const delta = cmax - cmin;
        let h = 0, s = 0, l = 0;

        if (delta == 0)
            h = 0;
        else if (cmax == r)
            h = ((g - b) / delta) % 6;
        else if (cmax == g)
            h = (b - r) / delta + 2;
        else
            h = (r - g) / delta + 4;

        h = Math.round(h * 60);
        if (h < 0)
            h += 360;

        l = (cmax + cmin) / 2;
        s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l -1));
        s = +(s * 100).toFixed(1);
        l = +(l * 100).toFixed(1);

        return {h, s, l};
    }

    function hslToHex(h, s, l) {
        s /= 100;
        l /= 100;
        const c = (1 - Math.abs(2 * l - 1)) * s;
        const x = c * (1 - Math.abs((h / 60) % 2 - 1));
        const m = l - c/2;
        let r = 0, g = 0, b = 0;

        if (0 <= h && h < 60) {
            r = c; g = x; b = 0;
        } else if (60 <= h && h < 120) {
            r = x; g = c; b = 0;
        } else if (120 <= h && h < 180) {
            r = 0; g = c; b = x;
        } else if (180 <= h && h < 240) {
            r = 0; g = x; b = c;
        } else if (240 <= h && h < 300) {
            r = x; g = 0; b = c;
        } else if (300 <= h && h < 360) {
            r = c; g = 0; b = x;
        }

        r = Math.round((r + m) * 255);
        g = Math.round((g + m) * 255);
        b = Math.round((b + m) * 255);

        const rHex = ("0" + r.toString(16)).slice(-2);
        const gHex = ("0" + g.toString(16)).slice(-2);
        const bHex = ("0" + b.toString(16)).slice(-2);

        return "#" + rHex + gHex + bHex;
    }
</script>

</body>
</html>
