<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Icebreaker Widget</title>
    <!-- Include Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
        }
        #widget-container {
            position: relative;
            width: 320px;
            height: 180px;
            background: transparent;
            overflow: hidden;
            perspective: 1000px;
        }
        #widget-image {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: auto;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: filter 0.3s;
            transform-origin: center center;
        }
        #widget-image:hover {
            filter: brightness(1.2);
        }
        .explode {
            animation: explodeAndFade 0.3s forwards;
        }
        @keyframes explodeAndFade {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.5);
            }
        }
        #icebreaker-card {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px;
            height: 180px;
            background-color: #F8F0E3;
            border-radius: 15px;
            padding: 20px;
            box-sizing: border-box;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation-duration: 0.5s;
            animation-fill-mode: forwards;
            overflow: hidden;
            transform: translate(-50%, -50%);
            transform-origin: center center;
            backface-visibility: hidden;
        }
        #icebreaker-text {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1em;
            color: #333;
            line-height: 1.5;
            font-weight: normal;
            letter-spacing: 0.05em;
            margin: 0;
            background: transparent;
        }
        #cover-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px;
            height: 180px;
            background-color: #3B1C0A;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            z-index: 10;
            padding: 10px;
            box-sizing: border-box;
            border-radius: 15px;
            transform-origin: center center;
            backface-visibility: hidden;
            /* Start smaller and animate zoom in */
            animation: zoomIn 1s forwards;
        }
        #cover-text {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1.2em;
            font-weight: bold;
            line-height: 1.4;
            letter-spacing: 0.05em;
            margin: 0;
        }
        #cover-text span {
            font-weight: normal;
        }
        /* Animation for zooming in the cover overlay */
        @keyframes zoomIn {
            0% {
                transform: translate(-50%, -50%) scale(0.3);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        /* Animation for zooming out the cover overlay */
        @keyframes zoomOut {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(0.3);
                opacity: 0;
            }
        }
        /* Adjust existing animations */
        @keyframes coverFadeIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) rotateY(-90deg) scale(0.3);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) rotateY(0deg) scale(1);
            }
        }
        @keyframes coverFadeOutFlip {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) rotateY(0deg) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) rotateY(90deg) scale(0.3);
            }
        }
        @keyframes fadeInFlip {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) rotateY(-90deg);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) rotateY(0deg);
            }
        }
        @keyframes fadeOutFlip {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) rotateY(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) rotateY(90deg);
            }
        }
    </style>
</head>
<body>

<div id="widget-container">
    <!-- Cover Overlay -->
    <div id="cover-overlay">
        <div id="cover-text">
            Fun Ice Breaker<br>
            Questions<br><br>
            <span>Click here</span>
        </div>
    </div>
    <!-- Ice Cubes Image -->
    <img id="widget-image" src="ice-cubes.png" alt="Ice Cubes">
    <!-- Icebreaker Card -->
    <div id="icebreaker-card">
        <div id="icebreaker-text"></div>
    </div>
</div>

<!-- Audio element for the ice breaking sound -->
<audio id="ice-sound" src="ice-10-104149.mp3" preload="auto"></audio>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const prompts = [
            // ... (your array of prompts)
        ];

        // Image source
        const initialImageSrc = "ice-cubes.png";
        const clickImageSrc = "broken-ice.png";

        const widgetContainer = document.getElementById('widget-container');
        const widgetImage = document.getElementById('widget-image');
        const icebreakerCard = document.getElementById('icebreaker-card');
        const icebreakerText = document.getElementById('icebreaker-text');
        const iceSound = document.getElementById('ice-sound');
        const coverOverlay = document.getElementById('cover-overlay');

        // Set initial image source
        widgetImage.src = initialImageSrc;
        widgetImage.style.display = 'none'; // Hide initially

        // Use a JavaScript variable to track if it's the first interaction
        let isFirstTime = true;

        // Function to proceed to the next step after the cover overlay
        function proceedAfterCover() {
            // Hide the cover overlay
            coverOverlay.style.display = 'none';
            // Show the ice cubes image
            widgetImage.style.display = 'block';
        }

        // Function to reverse to the initial state
        function reverseToInitialState() {
            // Hide the ice cubes image and icebreaker card
            widgetImage.style.display = 'none';
            icebreakerCard.style.display = 'none';
            // Reset cover overlay styles
            coverOverlay.style.display = 'flex';
            coverOverlay.style.animation = 'zoomIn 1s forwards';
            isFirstTime = true;
        }

        // Event listener for double-click to reverse
        coverOverlay.addEventListener('dblclick', () => {
            reverseToInitialState();
        });

        // After the zoom-in animation completes, hold for up to five seconds, then proceed
        coverOverlay.addEventListener('animationend', (event) => {
            if (event.animationName === 'zoomIn') {
                setTimeout(() => {
                    if (isFirstTime) {
                        proceedAfterCover();
                        isFirstTime = false;
                    }
                }, 5000); // Hold for 5 seconds
            }
        });

        // Click event on the ice cubes image
        widgetImage.addEventListener('click', () => {
            // Play random portion of the ice sound
            playRandomIceSound();

            // Change to broken ice image
            widgetImage.src = clickImageSrc;

            // Add class to trigger exploding animation
            widgetImage.classList.add('explode');

            // Listen for animation end
            widgetImage.addEventListener('animationend', onExplodeAnimationEnd, { once: true });
        });

        function onExplodeAnimationEnd() {
            // Hide the image
            widgetImage.style.display = 'none';
            // Remove the explode class
            widgetImage.classList.remove('explode');
            // Reset the transform
            widgetImage.style.transform = 'translate(-50%, -50%)';
            // Reset the size
            widgetImage.style.width = '50%';
            // Show the icebreaker card
            showIcebreaker();
        }

        function showIcebreaker() {
            icebreakerText.textContent = getRandomPrompt();

            // Adjust background color randomly within Â±10% lightness
            const baseColor = '#F8F0E3';
            const hsl = hexToHsl(baseColor);
            const lightnessAdjustment = (Math.random() * 20) - 10;
            const newL = Math.min(100, Math.max(0, hsl.l + lightnessAdjustment));
            const newColor = hslToHex(hsl.h, hsl.s, newL);

            icebreakerCard.style.backgroundColor = newColor;

            icebreakerCard.style.display = 'flex';
            icebreakerCard.style.animationName = 'fadeInFlip';
        }

        icebreakerCard.addEventListener('click', () => {
            icebreakerCard.style.animationName = 'fadeOutFlip';
            icebreakerCard.addEventListener('animationend', () => {
                icebreakerCard.style.display = 'none';
                widgetImage.src = initialImageSrc;
                widgetImage.style.display = 'block';
                widgetImage.style.width = '50%';
                widgetImage.style.transform = 'translate(-50%, -50%)';
            }, { once: true });
        });

        function getRandomPrompt() {
            const randomIndex = Math.floor(Math.random() * prompts.length);
            return prompts[randomIndex];
        }

        function playRandomIceSound() {
            const duration = 0.5;

            if (iceSound.readyState >= 2) {
                const totalDuration = iceSound.duration;
                const maxStartTime = Math.max(0, totalDuration - duration);
                const randomStartTime = Math.random() * maxStartTime;
                iceSound.currentTime = randomStartTime;
                iceSound.play();

                setTimeout(() => {
                    iceSound.pause();
                    iceSound.currentTime = 0;
                }, duration * 1000);
            } else {
                iceSound.addEventListener('loadedmetadata', () => {
                    playRandomIceSound();
                }, { once: true });
            }
        }

        // Helper functions to convert between Hex and HSL
        function hexToHsl(hex) {
            let r = 0, g = 0, b = 0;
            if (hex.length === 4) {
                r = parseInt(hex[1] + hex[1], 16);
                g = parseInt(hex[2] + hex[2], 16);
                b = parseInt(hex[3] + hex[3], 16);
            } else if (hex.length === 7) {
                r = parseInt(hex[1] + hex[2], 16);
                g = parseInt(hex[3] + hex[4], 16);
                b = parseInt(hex[5] + hex[6], 16);
            }
            r /= 255;
            g /= 255;
            b /= 255;
            const cmin = Math.min(r, g, b);
            const cmax = Math.max(r, g, b);
            const delta = cmax - cmin;
            let h = 0, s = 0, l = 0;

            if (delta === 0)
                h = 0;
            else if (cmax === r)
                h = ((g - b) / delta) % 6;
            else if (cmax === g)
                h = (b - r) / delta + 2;
            else
                h = (r - g) / delta + 4;

            h = Math.round(h * 60);
            if (h < 0)
                h += 360;

            l = (cmax + cmin) / 2;
            s = delta === 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
            s = +(s * 100).toFixed(1);
            l = +(l * 100).toFixed(1);

            return { h, s, l };
        }

        function hslToHex(h, s, l) {
            s /= 100;
            l /= 100;
            const c = (1 - Math.abs(2 * l - 1)) * s;
            const x = c * (1 - Math.abs((h / 60) % 2 - 1));
            const m = l - c / 2;
            let r = 0, g = 0, b = 0;

            if (0 <= h && h < 60) {
                r = c; g = x; b = 0;
            } else if (60 <= h && h < 120) {
                r = x; g = c; b = 0;
            } else if (120 <= h && h < 180) {
                r = 0; g = c; b = x;
            } else if (180 <= h && h < 240) {
                r = 0; g = x; b = c;
            } else if (240 <= h && h < 300) {
                r = x; g = 0; b = c;
            } else if (300 <= h && h < 360) {
                r = c; g = 0; b = x;
            }

            r = Math.round((r + m) * 255);
            g = Math.round((g + m) * 255);
            b = Math.round((b + m) * 255);

            const rHex = ("0" + r.toString(16)).slice(-2);
            const gHex = ("0" + g.toString(16)).slice(-2);
            const bHex = ("0" + b.toString(16)).slice(-2);

            return "#" + rHex + gHex + bHex;
        }
    });
</script>

</body>
</html>
