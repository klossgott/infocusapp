<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Icebreaker Widget</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
        }
        #widget-container {
            position: relative;
            width: 320px;
            height: 180px;
            background: transparent;
            overflow: hidden;
            perspective: 1000px;
        }
        #widget-image {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50%;
            height: auto;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: filter 0.3s;
            transform-origin: center center;
        }
        #widget-image:hover {
            filter: brightness(1.2);
        }
        .explode {
            animation: explodeAndFade 0.3s forwards;
        }
        @keyframes explodeAndFade {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.5);
            }
        }
        #icebreaker-card {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px;
            height: 180px;
            background-color: #F8F0E3;
            border-radius: 15px;
            padding: 20px;
            box-sizing: border-box;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation-duration: 0.5s;
            animation-fill-mode: forwards;
            overflow: hidden;
            transform: translate(-50%, -50%);
            transform-origin: center center;
            backface-visibility: hidden;
        }
        #icebreaker-text {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1em;
            color: #333;
            line-height: 1.5;
            font-weight: normal;
            letter-spacing: 0.05em;
            margin: 0;
            background: transparent;
        }
        #cover-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 320px;
            height: 180px;
            background-color: #3B1C0A;
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            z-index: 10;
            padding: 10px;
            box-sizing: border-box;
            border-radius: 15px;
            transform: translate(-50%, -50%);
            transform-origin: center center;
            backface-visibility: hidden;
            transition: transform 0.5s ease;
        }
        #cover-overlay.resting {
            transform: translate(-50%, -50%) scale(0.3);
        }
        #cover-overlay.expanded {
            transform: translate(-50%, -50%) scale(1);
        }
        #cover-text {
            font-family: 'Montserrat', Arial, sans-serif;
            font-size: 1.2em;
            font-weight: bold;
            line-height: 1.4;
            letter-spacing: 0.05em;
            margin: 0;
        }
        #cover-text span {
            font-weight: normal;
        }
        @keyframes coverFadeIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.3);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.3);
            }
        }
        @keyframes coverFadeOutFlip {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) rotateY(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) rotateY(90deg);
            }
        }
        @keyframes fadeInFlip {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) rotateY(-90deg);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) rotateY(0deg);
            }
        }
        @keyframes fadeOutFlip {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) rotateY(0deg);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) rotateY(90deg);
            }
        }
    </style>
</head>
<body>

<div id="widget-container">
    <!-- Cover Overlay -->
    <div id="cover-overlay" class="resting">
        <div id="cover-text">
            Fun Ice Breaker<br>
            Questions<br><br>
            <span>Click to expand<br>Double-click to minimize</span>
        </div>
    </div>
    <!-- Ice Cubes Image -->
    <img id="widget-image" src="ice-cubes.png" alt="Ice Cubes">
    <!-- Icebreaker Card -->
    <div id="icebreaker-card">
        <div id="icebreaker-text"></div>
    </div>
</div>

<audio id="ice-sound" src="ice-10-104149.mp3" preload="auto"></audio>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const prompts = [
            // ... your existing prompts array ...
        ];

        const widgetImage = document.getElementById('widget-image');
        const icebreakerCard = document.getElementById('icebreaker-card');
        const icebreakerText = document.getElementById('icebreaker-text');
        const iceSound = document.getElementById('ice-sound');
        const coverOverlay = document.getElementById('cover-overlay');

        // Initial state
        coverOverlay.style.display = 'flex';
        
        let isExpanded = false;

        // Handle single click to expand
        coverOverlay.addEventListener('click', (e) => {
            if (!isExpanded) {
                coverOverlay.classList.remove('resting');
                coverOverlay.classList.add('expanded');
                isExpanded = true;
            } else if (!e.detail || e.detail === 1) { // Single click when expanded
                coverOverlay.style.animation = 'coverFadeOutFlip 0.5s forwards';
                coverOverlay.addEventListener('animationend', () => {
                    coverOverlay.style.display = 'none';
                    widgetImage.style.display = 'block';
                }, { once: true });
            }
        });

        // Handle double click to minimize
        coverOverlay.addEventListener('dblclick', () => {
            if (isExpanded) {
                coverOverlay.classList.remove('expanded');
                coverOverlay.classList.add('resting');
                isExpanded = false;
            }
        });

        // Reset to resting state
        function resetToResting() {
            coverOverlay.style.display = 'flex';
            coverOverlay.style.animation = '';
            coverOverlay.classList.remove('expanded');
            coverOverlay.classList.add('resting');
            isExpanded = false;
            widgetImage.style.display = 'none';
            icebreakerCard.style.display = 'none';
        }

        // Your existing widget image click handler
        widgetImage.addEventListener('click', () => {
            playRandomIceSound();
            widgetImage.src = 'broken-ice.png';
            widgetImage.classList.add('explode');
            widgetImage.addEventListener('animationend', onExplodeAnimationEnd, { once: true });
        });

        function onExplodeAnimationEnd() {
            widgetImage.style.display = 'none';
            widgetImage.classList.remove('explode');
            widgetImage.style.transform = 'translate(-50%, -50%)';
            widgetImage.style.width = '50%';
            showIcebreaker();
        }

        function showIcebreaker() {
            icebreakerText.textContent = getRandomPrompt();
            const baseColor = '#F8F0E3';
            const hsl = hexToHsl(baseColor);
            const lightnessAdjustment = (Math.random() * 20) - 10;
            const newL = Math.min(100, Math.max(0, hsl.l + lightnessAdjustment));
            const newColor = hslToHex(hsl.h, hsl.s, newL);
            icebreakerCard.style.backgroundColor = newColor;
            icebreakerCard.style.display = 'flex';
            icebreakerCard.style.animationName = 'fadeInFlip';
        }

        // Modified card click handler to return to resting state
        icebreakerCard.addEventListener('click', () => {
            icebreakerCard.style.animationName = 'fadeOutFlip';
            icebreakerCard.addEventListener('animationend', () => {
                resetToResting();
            }, { once: true });
        });

        function getRandomPrompt() {
            return prompts[Math.floor(Math.random() * prompts.length)];
        }

        function playRandomIceSound() {
            const duration = 0.5;
            if (iceSound.readyState >= 2) {
                const totalDuration = iceSound.duration;
                const maxStartTime = Math.max(0, totalDuration - duration);
                const randomStartTime = Math.random() * maxStartTime;
                iceSound.currentTime = randomStartTime;
                iceSound.play();
                setTimeout(() => {
                    iceSound.pause();
                    iceSound.currentTime = 0;
                }, duration * 1000);
            } else {
                iceSound.addEventListener('loadedmetadata', () => {
                    playRandomIceSound();
                }, { once: true });
            }
        }

        // Your existing color conversion functions
        function hexToHsl(hex) {
            // ... your existing hexToHsl function ...
        }

        function hslToHex(h, s, l) {
            // ... your existing hslToHex function ...
        }
    });
</script>

</body>
</html>
