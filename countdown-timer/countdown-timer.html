<!-- Front-end: index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://fonts.googleapis.com/css2?family=Futura:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Emoji&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Futura', Arial, sans-serif;
            background: transparent;
            color: black;
            text-align: center;
        }
        #timer-container {
            display: inline-block;
            padding: 20px;
            position: relative;
            cursor: pointer;
        }
        #timer, #countdownInput {
            font-size: 3em;
            margin-top: 20px;
            opacity: 0;
            transition: opacity 3s ease-in-out, font-weight 0.5s ease-in-out;
            letter-spacing: 0.1em;
            font-family: 'Futura', sans-serif;
            text-align: center;
        }
        #timer.show, #countdownInput.show {
            opacity: 1;
        }
        .flashing {
            animation: smoothFlash 2s infinite alternate;
            font-weight: bold;
        }
        @keyframes smoothFlash {
            0% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        .control-button {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            margin: 10px;
            color: black;
            opacity: 0.3;
            transition: opacity 0.3s ease-in-out;
            font-family: 'Noto Emoji', sans-serif;
            pointer-events: none;
        }
        .control-button.active {
            opacity: 1;
            pointer-events: all;
        }
        .control-button:hover {
            opacity: 0.5;
        }
        #countdownInput.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #error-message {
            color: black;
            font-size: 1em;
            margin-top: 5px;
            display: block;
            font-family: 'Futura', sans-serif;
        }
        #thumbs-up {
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            opacity: 0;
            transition: opacity 3s ease-in-out;
            font-family: 'Noto Emoji', sans-serif;
        }
    </style>
    <script>
        let timerInterval;
        let isFlashing = false;
        let remainingTime = 0;
        let timerRunning = false;
        let timerPaused = false;

        function startCountdown(duration) {
            clearInterval(timerInterval);
            const endDate = new Date().getTime() + duration * 1000;
            isFlashing = false;
            document.getElementById('timer').classList.remove('flashing');
            document.getElementById('timer').classList.add('show');
            timerRunning = true;
            timerPaused = false;

            document.getElementById('countdownInput').classList.add('hidden');
            document.getElementById('error-message').style.display = 'none';

            function updateTimer() {
                const now = new Date().getTime();
                const distance = endDate - now;

                if (distance < 0) {
                    document.getElementById('timer').innerHTML = "Time's Up!";
                    document.getElementById('timer').classList.add('flashing');
                    clearInterval(timerInterval);
                    timerRunning = false;
                    playRandomNote();
                    return;
                }

                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('timer').innerHTML = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;

                if (distance < 10000 && !isFlashing) { // Start flashing when less than 10 seconds left
                    isFlashing = true;
                    document.getElementById('timer').classList.add('flashing');
                }
            }

            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        function stopCountdown() {
            clearInterval(timerInterval);
            document.getElementById('timer').classList.remove('flashing');
            document.getElementById('timer').style.opacity = '0'; // Fade out timer for thumbs up
            timerRunning = false;
            timerPaused = false;

            // Show thumbs up icon
            setTimeout(() => {
                document.getElementById('timer').innerHTML = "";
                const thumbsUp = document.getElementById('thumbs-up');
                thumbsUp.style.opacity = '1';
                setTimeout(() => {
                    thumbsUp.style.opacity = '0';
                    resetCountdown();
                }, 3000);
            }, 3000);
        }

        function resetCountdown() {
            clearInterval(timerInterval);
            document.getElementById('timer').innerHTML = "0:00";
            document.getElementById('timer').classList.remove('flashing');
            document.getElementById('timer').style.opacity = '1';
            timerRunning = false;
            timerPaused = false;
            document.getElementById('countdownInput').classList.remove('hidden');
            document.getElementById('countdownInput').classList.add('show');
        }

        function setCountdown() {
            const minutes = parseInt(document.getElementById('countdownInput').value, 10);
            if (!isNaN(minutes) && minutes > 0) {
                startCountdown(minutes * 60);
            } else {
                document.getElementById('error-message').innerText = "Please enter a valid number of minutes.";
                document.getElementById('error-message').style.display = 'block';
            }
        }

        function togglePauseCountdown() {
            if (timerRunning && !timerPaused) {
                clearInterval(timerInterval);
                const timerText = document.getElementById('timer').innerHTML.split(':');
                const minutes = parseInt(timerText[0], 10);
                const seconds = parseInt(timerText[1], 10);
                remainingTime = (minutes * 60) + seconds;
                timerPaused = true;
            } else if (timerPaused) {
                startCountdown(remainingTime);
            }
        }

        function playRandomNote() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const gainNode = audioCtx.createGain();
            gainNode.connect(audioCtx.destination);
            gainNode.gain.setValueAtTime(0.05, audioCtx.currentTime); // Set initial volume for a soft sound

            // Function to play a note with a given frequency and duration
            function playNoteWithFade(frequency, duration, delay) {
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime + delay);
                oscillator.connect(gainNode);
                gainNode.gain.setValueAtTime(0, audioCtx.currentTime + delay);
                gainNode.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + delay + 0.1); // Fade in
                gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + delay + duration); // Fade out
                oscillator.start(audioCtx.currentTime + delay);
                oscillator.stop(audioCtx.currentTime + delay + duration);
            }

            // Randomize two pentatonic frequencies and durations
            const pentatonicFrequencies = [261.63, 293.66, 329.63, 392.00, 440.00, 523.25, 587.33, 659.25];
            const frequency1 = pentatonicFrequencies[Math.floor(Math.random() * pentatonicFrequencies.length)];
            const frequency2 = pentatonicFrequencies[Math.floor(Math.random() * pentatonicFrequencies.length)];
            const duration1 = 0.5 + Math.random() * 0.5;
            const duration2 = 0.5 + Math.random() * 0.5;

            // Play two notes in sequence with fade in/out
            playNoteWithFade(frequency1, duration1, 0);
            playNoteWithFade(frequency2, duration2, duration1);
        }

        window.onload = function() {
            document.getElementById('countdownInput').classList.add('show');
            document.getElementById('startButton').addEventListener('click', setCountdown);
            document.getElementById('stopButton').addEventListener('click', stopCountdown);
            document.getElementById('pauseButton').addEventListener('click', togglePauseCountdown);
            document.getElementById('countdownInput').addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    setCountdown();
                }
            });
            document.getElementById('countdownInput').addEventListener('input', function() {
                // Activate Play button and gray out others
                document.getElementById('startButton').classList.add('active');
                document.getElementById('stopButton').classList.add('active');
                document.getElementById('pauseButton').classList.remove('active');
            });
        };
    </script>
</head>
<body>
    <div id="timer-container">
        <div id="timer" class="show">0:00</div>
        <div id="thumbs-up">üëç</div>
        <div style="margin-top: 20px;">
            <input type="number" id="countdownInput" placeholder="How long?" min="1">
            <div id="error-message"></div>
            <div>
                <button id="startButton" class="control-button">‚ñ∂</button>
                <button id="stopButton" class="control-button">‚ñ†</button>
                <button id="pauseButton" class="control-button">‚è∏</button>
            </div>
        </div>
    </div>
</body>
</html>
