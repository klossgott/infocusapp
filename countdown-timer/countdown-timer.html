<!-- Front-end: index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: transparent;
            color: black;
            text-align: center;
        }
        #timer-container {
            display: inline-block;
            padding: 20px;
            position: relative;
            cursor: pointer;
        }
        #timer {
            font-size: 3em;
            margin-top: 20px;
            opacity: 0;
            transition: opacity 2s ease-in-out, font-weight 0.5s ease-in-out;
            letter-spacing: 0.1em;
        }
        .flashing {
            animation: smoothFlash 1s infinite alternate;
        }
        @keyframes smoothFlash {
            0% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        .control-button {
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            margin: 10px;
            color: black;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            font-family: 'Noto Sans', sans-serif;
        }
        #timer-container:hover .control-button {
            opacity: 1;
        }
        #countdownInput {
            text-align: center;
            border: none;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        #countdownInput.hidden {
            display: none;
        }
    </style>
    <script>
        let timerInterval;
        let isFlashing = false;
        let remainingTime = 0;
        let timerRunning = false;
        let timerPaused = false;

        function startCountdown(duration) {
            clearInterval(timerInterval);
            const endDate = new Date().getTime() + duration * 1000;
            isFlashing = false;
            document.getElementById('timer').classList.remove('flashing');
            document.getElementById('timer').style.opacity = '1';
            timerRunning = true;
            timerPaused = false;

            document.getElementById('countdownInput').classList.add('hidden');

            function updateTimer() {
                const now = new Date().getTime();
                const distance = endDate - now;

                if (distance < 0) {
                    document.getElementById('timer').innerHTML = "Time's Up!";
                    document.getElementById('timer').classList.add('flashing');
                    clearInterval(timerInterval);
                    timerRunning = false;
                    playRandomNote();
                    return;
                }

                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('timer').innerHTML = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;

                if (distance < 10000 && !isFlashing) { // Start flashing when less than 10 seconds left
                    isFlashing = true;
                    document.getElementById('timer').classList.add('flashing');
                }
            }

            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }

        function stopCountdown() {
            clearInterval(timerInterval);
            document.getElementById('timer').classList.remove('flashing');
            document.getElementById('timer').style.visibility = 'visible';
            timerRunning = false;
            timerPaused = false;
            document.getElementById('countdownInput').classList.remove('hidden');
        }

        function resetCountdown() {
            clearInterval(timerInterval);
            document.getElementById('timer').innerHTML = "0:00";
            document.getElementById('timer').classList.remove('flashing');
            document.getElementById('timer').style.visibility = 'visible';
            document.getElementById('timer').style.opacity = '1';
            timerRunning = false;
            timerPaused = false;
            document.getElementById('countdownInput').classList.remove('hidden');
        }

        function setCountdown() {
            const minutes = parseInt(document.getElementById('countdownInput').value, 10);
            if (!isNaN(minutes)) {
                startCountdown(minutes * 60);
            } else {
                alert("Please enter a valid number of minutes.");
            }
        }

        function togglePauseCountdown() {
            if (timerRunning && !timerPaused) {
                clearInterval(timerInterval);
                const timerText = document.getElementById('timer').innerHTML.split(':');
                const minutes = parseInt(timerText[0], 10);
                const seconds = parseInt(timerText[1], 10);
                remainingTime = (minutes * 60) + seconds;
                timerPaused = true;
            } else if (timerPaused) {
                startCountdown(remainingTime);
            }
        }

        function playRandomNote() {
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            // Randomize frequency between 400 Hz and 600 Hz (pleasant middle range)
            const frequency = 400 + Math.random() * 200;
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);

            // Randomize duration between 1.5 to 2.5 seconds
            const duration = 1.5 + Math.random();

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + duration);
        }

        window.onload = function() {
            document.getElementById('timer').style.opacity = '1';
            document.getElementById('startButton').addEventListener('click', setCountdown);
            document.getElementById('stopButton').addEventListener('click', stopCountdown);
            document.getElementById('resetButton').addEventListener('click', resetCountdown);
            document.getElementById('pauseButton').addEventListener('click', togglePauseCountdown);
            document.getElementById('timer-container').addEventListener('click', function() {
                if (timerRunning && !timerPaused) {
                    togglePauseCountdown();
                } else if (timerPaused) {
                    togglePauseCountdown();
                } else {
                    setCountdown();
                }
            });
        };
    </script>
</head>
<body>
    <div id="timer-container">
        <div id="timer">0:00</div>
        <div style="margin-top: 20px;">
            <input type="number" id="countdownInput" placeholder="Enter minutes" min="1">
            <div>
                <button id="startButton" class="control-button">Start</button>
                <button id="stopButton" class="control-button">Stop</button>
                <button id="pauseButton" class="control-button">Pause/Resume</button>
                <button id="resetButton" class="control-button">Reset</button>
            </div>
        </div>
    </div>
</body>
</html>
